<!doctype html>
<html lang="en-us">
  <head>
    <title>Week7_文件读写 // twangreal的博客</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.67.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="twangreal" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://twangreal.github.io/css/main.min.f90f5edd436ec7b74ad05479a05705770306911f721193e7845948fb07fe1335.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Week7_文件读写"/>
<meta name="twitter:description" content="一、字符文件读写 //字符文件读写， 即对txt文件的读写 #include &lt;iostream&gt;#include &lt;fstream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std; int main() { vector&lt;int&gt; v; ifstream srcFile(&#34;in.txt&#34;,ios::in);//打开、创建相应文件，ios::in文件打开方式 	ofstream destFile(&#34;out.txt&#34;,ios::out);//打开、创建相应文件，ios::out文件打开方式  //等价于 ofstream fout; fout.open(&#34;out.txt&#34;,ios::out);  //判断是否打开成功 if（!fout）{ cout &lt;&lt; “File open error!”&lt;&lt;endl; } 	int x; while( srcFile &gt;&gt; x ) //读入，ifstream的对象代替 cin 	v.push_back(x); sort(v.begin(),v.end()); for( int i = 0;i &lt; v.size();i &#43;&#43; ) destFile &lt;&lt; v[i] &lt;&lt; &#34; &#34;; //输出写入到文件，ofstream的对象代替 cout 	destFile.close(); srcFile.close(); return 0; } 二、二进制文件读写 二进制读文件："/>

    <meta property="og:title" content="Week7_文件读写" />
<meta property="og:description" content="一、字符文件读写 //字符文件读写， 即对txt文件的读写 #include &lt;iostream&gt;#include &lt;fstream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std; int main() { vector&lt;int&gt; v; ifstream srcFile(&#34;in.txt&#34;,ios::in);//打开、创建相应文件，ios::in文件打开方式 	ofstream destFile(&#34;out.txt&#34;,ios::out);//打开、创建相应文件，ios::out文件打开方式  //等价于 ofstream fout; fout.open(&#34;out.txt&#34;,ios::out);  //判断是否打开成功 if（!fout）{ cout &lt;&lt; “File open error!”&lt;&lt;endl; } 	int x; while( srcFile &gt;&gt; x ) //读入，ifstream的对象代替 cin 	v.push_back(x); sort(v.begin(),v.end()); for( int i = 0;i &lt; v.size();i &#43;&#43; ) destFile &lt;&lt; v[i] &lt;&lt; &#34; &#34;; //输出写入到文件，ofstream的对象代替 cout 	destFile.close(); srcFile.close(); return 0; } 二、二进制文件读写 二进制读文件：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://twangreal.github.io/post/week7_%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/" />
<meta property="article:published_time" content="2020-04-04T17:18:27+08:00" />
<meta property="article:modified_time" content="2020-04-04T17:18:27+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://twangreal.github.io/"><img class="app-header-avatar" src="/personal/cyberpunk1.jpg" alt="twangreal" /></a>
      <h1>twangreal的博客</h1>
      <p>面向对象程序设计基于三个基本概念：数据抽象、继承和动态绑定。  后台开发：编程语言、编译调试、网络通信、常用类库、HTTP协议、进程通信。</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/twangreal" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Week7_文件读写</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 4, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div></div>
    </header>
    <div class="post-content">
      <h3 id="一字符文件读写">一、字符文件读写</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">//字符文件读写， 即对txt文件的读写
</span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() { 
	vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> v;
	ifstream srcFile(<span style="color:#e6db74">&#34;in.txt&#34;</span>,ios<span style="color:#f92672">::</span>in);<span style="color:#75715e">//打开、创建相应文件，ios::in文件打开方式
</span><span style="color:#75715e"></span>	ofstream destFile(<span style="color:#e6db74">&#34;out.txt&#34;</span>,ios<span style="color:#f92672">::</span>out);<span style="color:#75715e">//打开、创建相应文件，ios::out文件打开方式
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//等价于 ofstream fout;  fout.open(&#34;out.txt&#34;,ios::out);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//判断是否打开成功  if（!fout）{ cout &lt;&lt; “File open error!”&lt;&lt;endl; }
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> x;
	<span style="color:#66d9ef">while</span>( srcFile <span style="color:#f92672">&gt;&gt;</span> x )  <span style="color:#75715e">//读入，ifstream的对象代替 cin
</span><span style="color:#75715e"></span>		v.push_back(x);
	sort(v.begin(),v.end());
	<span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;i <span style="color:#f92672">&lt;</span> v.size();i <span style="color:#f92672">++</span> )
		destFile <span style="color:#f92672">&lt;&lt;</span> v[i] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;  <span style="color:#75715e">//输出写入到文件，ofstream的对象代替 cout
</span><span style="color:#75715e"></span>	destFile.close();
	srcFile.close(); 
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; 
}
</code></pre></div><h3 id="二二进制文件读写">二、二进制文件读写</h3>
<p>二进制读文件：</p>
<p>ifstream 和 fstream的成员函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">istream<span style="color:#f92672">&amp;</span> read (<span style="color:#66d9ef">char</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">*</span> s, <span style="color:#66d9ef">long</span> n);
</code></pre></div><p>将文件读指针指向的地方的n个字节内容，读入到内存地址s，然后将文件读指针向后移动n字节 (以ios::in方式打开文件时，文件读指针开始指向文件开头) 。</p>
<p>二进制写文件：</p>
<p>ofstream 和 fstream的成员函数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">istream<span style="color:#f92672">&amp;</span> write (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">*</span> s, <span style="color:#66d9ef">long</span> n);
</code></pre></div><p>将内存地址s处的n个字节内容，写入到文件中写指针指向的位置，然后将文件写指针向后移动n字节( <strong>以ios::out方式打开文件时，文件写指针开始指向文件开头, 以ios::app方式打开文件时，文件写指针开始指向文件尾部</strong>  ) 。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() { 
	ofstream fout(<span style="color:#e6db74">&#34;some.dat&#34;</span>, ios<span style="color:#f92672">::</span>out <span style="color:#f92672">|</span> ios<span style="color:#f92672">::</span>binary);<span style="color:#75715e">//打开、创建相应文件，ios::in文件打开方式
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> x<span style="color:#f92672">=</span><span style="color:#ae81ff">120</span>;
	fout.write( (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(<span style="color:#f92672">&amp;</span>x), <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>) );<span style="color:#75715e">//写入文件
</span><span style="color:#75715e"></span>	fout.close();
	ifstream fin(<span style="color:#e6db74">&#34;some.dat&#34;</span>,ios<span style="color:#f92672">::</span>in <span style="color:#f92672">|</span> ios<span style="color:#f92672">::</span>binary);<span style="color:#75715e">//打开相应文件，ios::out文件打开方式
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> y;
	fin.read((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> ) <span style="color:#f92672">&amp;</span> y,<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));<span style="color:#75715e">//从文件读取
</span><span style="color:#75715e"></span>	fin.close();
	cout <span style="color:#f92672">&lt;&lt;</span> y <span style="color:#f92672">&lt;&lt;</span>endl;
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p><strong>疑问：</strong>  只有ofstream对象能创建不存在的文件？</p>
<p>示例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Student</span> {
	<span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">20</span>];
	<span style="color:#66d9ef">int</span> score;
};
<span style="color:#75715e">//输出：
</span><span style="color:#75715e">//Tom 60
</span><span style="color:#75715e">//Jack 80
</span><span style="color:#75715e">//Mike 40
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
{
	Student s;
	fstream iofile( <span style="color:#e6db74">&#34;c:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">tmp</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">students.dat&#34;</span>, ios<span style="color:#f92672">::</span>in<span style="color:#f92672">|</span>ios<span style="color:#f92672">::</span>out<span style="color:#f92672">|</span>ios<span style="color:#f92672">::</span>binary);
	<span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span>iofile) {
		cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;error&#34;</span> ;
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
	}
	iofile.seekp( <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(s),ios<span style="color:#f92672">::</span>beg); <span style="color:#75715e">//定位写指针到第三个记录
</span><span style="color:#75715e"></span>	iofile.write(<span style="color:#e6db74">&#34;Mike&#34;</span>,strlen(<span style="color:#e6db74">&#34;Mike&#34;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
	iofile.seekg(<span style="color:#ae81ff">0</span>,ios<span style="color:#f92672">::</span>beg); <span style="color:#75715e">//定位读指针到开头，一个指针由读写功能？还是两个指针位置一致？
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">while</span>( iofile.read( (<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> ) <span style="color:#f92672">&amp;</span> s, <span style="color:#66d9ef">sizeof</span>(s)) ) 
		cout <span style="color:#f92672">&lt;&lt;</span> s.name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">&lt;&lt;</span> s.score <span style="color:#f92672">&lt;&lt;</span> endl;
	iofile.close();
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>PS.为什么采用二进制文件而不是文本文件存放信息？1.节省空间（如十二位的整型数，文本要十二个字节，二进制只要4字节）；2.查找和排序（如上面的student类，文本存放信息，每个学生信息占用的字节大小不固定，不方便进行查找和排序操作；而二进制存放则是固定student类对象的大小）</p>
<h3 id="三文件拷贝程序mycopy示例">三、文件拷贝程序mycopy示例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">/*用法示例：
</span><span style="color:#75715e">mycopy src.dat dest.dat 
</span><span style="color:#75715e">即将 src.dat 拷贝到 dest.dat 如果 dest.dat 原来就有，则原来的文件会被覆
</span><span style="color:#75715e">盖 */</span>
<span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]){  <span style="color:#75715e">///？？？？argc命令行参数个数，argv就是参数
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span>( argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">3</span> ) {
        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;File name missing!&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
	}
	ifstream inFile(argv[<span style="color:#ae81ff">1</span>],ios<span style="color:#f92672">::</span>binary<span style="color:#f92672">|</span>ios<span style="color:#f92672">::</span>in); <span style="color:#75715e">//打开文件用于读
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span> inFile ) {
		cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Source file open error.&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
	}
	ofstream outFile(argv[<span style="color:#ae81ff">2</span>],ios<span style="color:#f92672">::</span>binary<span style="color:#f92672">|</span>ios<span style="color:#f92672">::</span>out); <span style="color:#75715e">//打开文件用于写
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span>outFile) {
		cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;New file open error.&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
		inFile.close(); <span style="color:#75715e">//打开的文件一定要关闭
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
	}
	<span style="color:#66d9ef">char</span> c;
	<span style="color:#66d9ef">while</span>( inFile.get(c)) <span style="color:#75715e">//每次读取一个字符，和read区别：read一次可读取多个字节
</span><span style="color:#75715e"></span>		outFile.put(c); <span style="color:#75715e">//每次写入一个字符，write一次可写入多个字节
</span><span style="color:#75715e"></span>	
    outFile.close(); 
	inFile.close();
	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><h3 id="四二进制文件和文本文件的区别">四、二进制文件和文本文件的区别</h3>
<p>Linux,Unix下的换行符号：‘\n’ (ASCII码: 0x0a)</p>
<p>Windows 下的换行符号：‘\r\n’ (ASCII码： 0x0d0a) endl 就是 &lsquo;\n&rsquo;</p>
<p>Mac OS下的换行符号： ‘\r’ (ASCII码：0x0d)</p>
<p>=》导致 Linux, Mac OS 文本文件在Windows 记事本中打开时不换行；相对的，Windows文本文件再linux、Mac OS中打开会换行，但会多一个字符&rsquo;\r'或&rsquo;\n&rsquo; 。</p>
<p>Unix/Linux下打开文件，用不用 ios::binary 没区别；</p>
<p>Windows下打开文件，如果不用 ios::binary，则：</p>
<p>​	<strong>读取文件时，所有的 &lsquo;\r\n’会被当做一个字符&rsquo;\n'处理，即少读了一个字符&rsquo;\r&rsquo;。</strong></p>
<p>​	<strong>写入文件时，写入单独的&rsquo;\n'时，系统自动在前面加一个&rsquo;\r&rsquo;，即多写了一个&rsquo;\r&rsquo;</strong></p>
<p><strong>PS.</strong> 文本文件可用“ifstream类的对象名&raquo;变量名”的形式读取数据，“ofstream类的对象名&laquo;变量名”的形式写入数据；</p>
<p>二进制文件则用ifstream类、ofstream类、fstream类的成员函数read、write、get、put等读取写入数据。</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
